---
title: "TestRM"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

You can also embed plots, for example:

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='hide'}
#setwd("/home/jon/git/CS6240/hw2/Cai_Jun_A2/")
res <- data.frame(month=character(),
                  carrier=character(), 
                  totalFl=integer(), 
				          meanPrice=double(),
                  stringsAsFactors=FALSE) 

filenames <- list.files("output", pattern="part-r-*", full.names=TRUE)
for (i in 1:length(filenames))
	res <- rbind(res, read.csv(file=filenames[i], head=FALSE))

res <- res[complete.cases(res),]
names(res) <- c("month", "carrier", "totalFl", "meanPrice")

# find the top 10 carriers with most flights
require(plyr)
carrier_flnum <- ddply(res,~carrier,summarise,totalFL=mean(totalFl))
attach(carrier_flnum)
sorted_carrier <- carrier_flnum[order(totalFL, decreasing=TRUE),]
top_carriers <- sorted_carrier[1:10,]
top_carriers <- top_carriers$carrier

# loop through top carriers and plot the mean prices for each month
opar <- par(no.readonly=TRUE)
# get min and max price, then config the y-axis
min_price <- min(res[,4])
max_price <- max(res[,4])

colcolors <- rainbow(10)

c_carrier <- top_carriers[1]
c_df <- res[res$carrier == c_carrier,]
attach(c_df)
c_sorted <- c_df[order(month),]
plot(c_sorted$month, c_sorted$meanPrice, type="l",
	 main="Mean Ticket Prices for Each Month for Each Carrier",
	 xlab="Month", ylab="Mean Ticket Price",
	 col="blue",
	 ylim=c(min_price, max_price))
ltys <- c(2, 2, 2, 2, 2, 2, 2, 2, 2, 2)
pchs <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
for (i in 1:10)
{
	c_carrier <- top_carriers[i]
	c_df <- res[res$carrier == c_carrier,]
	attach(c_df)
	c_sorted <- c_df[order(month),]
	lines(c_sorted$month, c_sorted$meanPrice, col=colcolors[i], pch=pchs[i], lty=ltys[i], type="o")
}
# create legends
legend("topleft", inset=.05, title="Carrier", legend=top_carriers, lty=ltys, pch=pchs, col=colcolors)
par(opar)
```

